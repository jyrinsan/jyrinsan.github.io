[Etusivu](index.html) 
&emsp;[H1](h1.html)
&emsp;[H2](h2.html)
&emsp;[H3](h3.html)
&emsp;[H4](h4.html)
&emsp;H5
&emsp;[H6](h6.html)
&emsp;[H7](h7.html)

# Harjoitus 5 - Uusi komento

```
Nimi              Sanna Jyrinki
Oppilaitos        Haaga-Helian ammattikorkeakoulu
Kurssi            Palvelinten hallinta ICT4TN022-3015
Opettaja          Tero Karvinen
Tietokoneena      AMD Ryzen 5 PRO 4650U with Radeon Graphics 2.10 GHz
Käyttöjärjestelmä Windows 11 Pro, Versio 21H2
Linux             Oracle Virtual Box 6.1, Debian 11.3
```

## Alkutoimet

Asensin tämän harjoituksen alkuun, virtualboxiini kokonaan uuden Debian 11 virtuaalikoneen ja aloitin homman taas puhtaalta pöydältä. Asennuksen muistin jo ulkoa, mutta ohje löytyy [Linux palvelimet kurssin harjoituksesta 1](../h1.html). Tästä saa rutiinia ja toisaalta koneeni oli jo melko täynnä saltin tiloja ja asennettuja ohjelmia, joten oli helpompi luoda kokonaan uusi virtuaalikone.

Asensin uudelle virtuualikoneelleni sekä herran, että orjan, kuten tein [harjoituksen h1 tehtävässä f](https://jyrinsan.github.io/palvelintenhallinta/h1.html#f).

## Tehtävä a, Hei komento!

Teen shell-skriptin, joka tulostaa "hei maailma". Ensin teen skriptin omaan kotihakemistooni:

![Image](h5_images/h5_1.PNG)

Testasin toimiiko
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$bash heimaailma.sh 
Hello world
</pre>

Ilman bash käskyä ei toimi, koska ei ole riittävästi oikeuksia:
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ ./heimaailma.sh
bash: ./heimaailma.sh: Permission denied
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ ls -l
-rw-r--r-- 1 sanna sanna   31 28. 4. 21:33 heimaailma.sh
</pre>

Lisätään kaikille suoritus (x) oikeudet ja testataan, nyt käsky toimii suoraan
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ chmod ugo+x heimaailma.sh 
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ ./heimaailma.sh 
Hello world
</pre>

Siirretään komento kaikkien käyttäjien kutsuttavaksi mistä vaan hakemistosta hakemistoon /usr/local/bin:
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ sudo cp heimaailma.sh /usr/local/bin/
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ pwd
/home/sanna
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ heimaailma.sh
Hello world
</pre>

Nyt automatisoidaan saltille, tehdään /srv/salt/heimaailma/init.sls tiedosto, joka tallentaa tiedoston. Ohjetta katsoin käskyllä 'salt-call --local sys.state_doc file.managed'

<pre>usr/local/bin/heimaailma.sh:
  file.managed:
    - source: salt://heimaailma/heimaailma.sh
    - user: root
    - group: root
    - mode: 0755
</pre>

Ennen kuin ajoin tilan saltilla, kopioin tiedoston saltin alle 'sudo cp /usr/local/bin/heimaailma.sh /srv/salt/heimaailma/' ja deletoin tiedoston 'sudo rm /usr/local/bin/heimaailma.sh', jotta salt asentaa tiedoston uudelleen.

Ajetaan
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>/srv/salt/heimaailma</b></font>$ sudo salt &apos;*&apos; state.apply heimaailma
<font color="#00AA00">sannanorja:</font>
<font color="#00AAAA">----------</font>
    <font color="#00AAAA">      ID: /usr/local/bin/heimaailma.sh</font>
    <font color="#00AAAA">Function: file.managed</font>
    <font color="#00AAAA">  Result: True</font>
    <font color="#00AAAA"> Comment: File /usr/local/bin/heimaailma.sh updated</font>
    <font color="#00AAAA"> Started: 23:33:07.854036</font>
    <font color="#00AAAA">Duration: 22.623 ms</font>
<font color="#00AAAA">     Changes:   </font>
<font color="#00AAAA">              ----------</font>
              <font color="#00AAAA">diff</font>:
                  <font color="#00AA00">New file</font>
              <font color="#00AAAA">mode</font>:
                  <font color="#00AA00">0755</font>

<font color="#00AAAA">Summary for sannanorja</font>
<font color="#00AAAA">------------</font>
<font color="#00AA00">Succeeded: 1</font> (<font color="#00AA00">changed=1</font>)
<font color="#00AAAA">Failed:    0</font>
<font color="#00AAAA">------------</font>
<font color="#00AAAA">Total states run:     1</font>
<font color="#00AAAA">Total run time:  22.623 ms</font>
</pre>

Menen testaamaan nyt saltin asentamaa tiedostoa ja katsomaan syntyikö oikeudet oikein:
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ cd
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ heimaailma.sh
Hello world
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ ls -l /usr/local/bin/heimaailma.sh 
-rwxr-xr-x 1 root root 31 29. 4. 18:40 <font color="#55FF55"><b>/usr/local/bin/heimaailma.sh</b></font>
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ 
</pre>

Skripti toimii ja kaikilla käyttäjillä on aivan oikein x eli execute eli suoritusoikeudet.

## Tehtävä b, whatsup.sh

Tee järjestelmään uusi komento, joka kertoo ajankohtaisia tietoja; asenna se orjille. Vinkkejä: Voit näyttää valintasi mukaan esimerkiksi päivämäärää, säätä, tietoja koneesta, verkon tilanteesta...

## Tehtävä c, hello.py

Tee järjestelmään uusi komento Pythonilla ja asenna se orjille. Vinkkejä: Hei maailma riittää, mutta propellihatut saavat toki koodaillakin. Shebang on "#!/usr/bin/python3". Helpoin Python-komento on: print("Hei Tero!")

## Tehtävä d, laiskaa skriptailua

Tee kansio, josta jokainen skripti kopioituu orjille. Vinkki: 'salt-call --local sys.state_doc file.recurse'. Kun tämä on valmis, on todella helppoa laittaa orjille mikä tahansa yhden tiedoston shell script, Python-ohjelma, Perl-ohjelma, Go-binääri tai muu yhden binäärin ohjelma.

## Tehtävä e, Intel

Etsi kolme loppuprojektia joltain vanhalta kurssitoteutukselta. Kuvaile projektit tiiviisti ja linkitä alkuperäiseeen raporttin. Vinkkejä: Loppuprojekteja löydät etsimällä opiskelijoiden raportteja vanhoilta kursseilta ja selailemalla sivuja, joilta ne löytyivät. Raportteja löytyy vanhojen kurssitotetusten kommenteista. Ja tietysti kannattaa silmäillä listaa sieltä täältä, niin näet eri projektit kuin muut. Voi hakea myös Googlella ja DuckDuckGolla.

## Tehtävä e (toinen e),  Lukua, ei luottamusta. 

Kokeile yhtä kohdassa d-Intel löytämääsi modulia koneella. Tämä on infraa koodina, joten luottamusta ei tarvita. Voit lukea koodista, mitä olet ajamassa.