[Etusivu](index.html) 
&emsp;[H1](h1.html)
&emsp;[H2](h2.html)
&emsp;[H3](h3.html)
&emsp;[H4](h4.html)
&emsp;H5
&emsp;[H6](h6.html)
&emsp;[H7](h7.html)

# Harjoitus 5 - Uusi komento

```
Nimi              Sanna Jyrinki
Oppilaitos        Haaga-Helian ammattikorkeakoulu
Kurssi            Palvelinten hallinta ICT4TN022-3015
Opettaja          Tero Karvinen
Tietokoneena      AMD Ryzen 5 PRO 4650U with Radeon Graphics 2.10 GHz
Käyttöjärjestelmä Windows 11 Pro, Versio 21H2
Linux             Oracle Virtual Box 6.1, Debian 11.3
```

## Alkutoimet

Asensin tämän harjoituksen alkuun, virtualboxiini kokonaan uuden Debian 11 virtuaalikoneen ja aloitin homman taas puhtaalta pöydältä. Asennuksen muistin jo ulkoa, mutta ohje löytyy [Linux palvelimet kurssin harjoituksesta 1](../h1.html). Tästä saa rutiinia ja toisaalta koneeni oli jo melko täynnä saltin tiloja ja asennettuja ohjelmia, joten oli helpompi luoda kokonaan uusi virtuaalikone.

Asensin uudelle virtuualikoneelleni sekä herran, että orjan, kuten tein [harjoituksen h1 tehtävässä f](https://jyrinsan.github.io/palvelintenhallinta/h1.html#f).

## Tehtävä a, Hei komento!

Teen shell-skriptin, joka tulostaa "hei maailma". Ensin teen skriptin omaan kotihakemistooni:

![Image](h5_images/h5_1.PNG)

Testasin toimiiko
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$bash heimaailma.sh 
Hello world
</pre>

Ilman bash käskyä ei toimi, koska ei ole riittävästi oikeuksia:
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ ./heimaailma.sh
bash: ./heimaailma.sh: Permission denied
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ ls -l
-rw-r--r-- 1 sanna sanna   31 28. 4. 21:33 heimaailma.sh
</pre>

Lisätään kaikille suoritus (x) oikeudet ja testataan, nyt käsky toimii suoraan
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ chmod ugo+x heimaailma.sh 
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ ./heimaailma.sh 
Hello world
</pre>

Siirretään komento kaikkien käyttäjien kutsuttavaksi mistä vaan hakemistosta hakemistoon /usr/local/bin:
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ sudo cp heimaailma.sh /usr/local/bin/
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ pwd
/home/sanna
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ heimaailma.sh
Hello world
</pre>

Nyt automatisoidaan saltille, tehdään /srv/salt/heimaailma/init.sls tiedosto, joka tallentaa tiedoston. Ohjetta katsoin käskyllä 'salt-call --local sys.state_doc file.managed'

<pre>usr/local/bin/heimaailma.sh:
  file.managed:
    - source: salt://heimaailma/heimaailma.sh
    - user: root
    - group: root
    - mode: 0755
</pre>

Ennen kuin ajoin tilan saltilla, kopioin tiedoston saltin alle 'sudo cp /usr/local/bin/heimaailma.sh /srv/salt/heimaailma/' ja deletoin tiedoston 'sudo rm /usr/local/bin/heimaailma.sh', jotta salt asentaa tiedoston uudelleen.

Ajetaan
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>/srv/salt/heimaailma</b></font>$ sudo salt &apos;*&apos; state.apply heimaailma
<font color="#00AA00">sannanorja:</font>
<font color="#00AAAA">----------</font>
    <font color="#00AAAA">      ID: /usr/local/bin/heimaailma.sh</font>
    <font color="#00AAAA">Function: file.managed</font>
    <font color="#00AAAA">  Result: True</font>
    <font color="#00AAAA"> Comment: File /usr/local/bin/heimaailma.sh updated</font>
    <font color="#00AAAA"> Started: 23:33:07.854036</font>
    <font color="#00AAAA">Duration: 22.623 ms</font>
<font color="#00AAAA">     Changes:   </font>
<font color="#00AAAA">              ----------</font>
              <font color="#00AAAA">diff</font>:
                  <font color="#00AA00">New file</font>
              <font color="#00AAAA">mode</font>:
                  <font color="#00AA00">0755</font>

<font color="#00AAAA">Summary for sannanorja</font>
<font color="#00AAAA">------------</font>
<font color="#00AA00">Succeeded: 1</font> (<font color="#00AA00">changed=1</font>)
<font color="#00AAAA">Failed:    0</font>
<font color="#00AAAA">------------</font>
<font color="#00AAAA">Total states run:     1</font>
<font color="#00AAAA">Total run time:  22.623 ms</font>
</pre>

Menen testaamaan nyt saltin asentamaa tiedostoa ja katsomaan syntyikö oikeudet oikein:
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ cd
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ heimaailma.sh
Hello world
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ ls -l /usr/local/bin/heimaailma.sh 
-rwxr-xr-x 1 root root 31 29. 4. 18:40 <font color="#55FF55"><b>/usr/local/bin/heimaailma.sh</b></font>
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ 
</pre>

Skripti toimii ja kaikilla käyttäjillä on aivan oikein x eli execute eli suoritusoikeudet.

## Tehtävä b, whatsup.sh

Sään saan selville weather komennolla, löysin ohjeen [täältä](https://www.maketecheasier.com/access-weather-forecasts-linux-command-line/#:~:text=Users%20of%20a%20Debian-based%20Linux%20distribution%20like%20Ubuntu,also%20download%20its%20source%20and%20install%20it%20manually.?msclkid=f4af4dcfc7e011ec840858928e5b1962)

Asennan ensin manuaalisesti
`sudo apt-get install weather-util`

Teen salt-tilan, joka asentaa sovelluksen
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>/srv/salt/whatsup</b></font>$ sudo salt &apos;*&apos; state.apply whatsup
<font color="#00AA00">sannanorja:</font>
<font color="#00AA00">----------</font>
    <font color="#00AA00">      ID: weather-util</font>
    <font color="#00AA00">Function: pkg.installed</font>
    <font color="#00AA00">  Result: True</font>
    <font color="#00AA00"> Comment: All specified packages are already installed</font>
    <font color="#00AA00"> Started: 20:31:05.719305</font>
    <font color="#00AA00">Duration: 63.668 ms</font>
<font color="#00AA00">     Changes:   </font>

<font color="#00AAAA">Summary for sannanorja</font>
<font color="#00AAAA">------------</font>
<font color="#00AA00">Succeeded: 1</font>
<font color="#00AAAA">Failed:    0</font>
<font color="#00AAAA">------------</font>
<font color="#00AAAA">Total states run:     1</font>
<font color="#00AAAA">Total run time:  63.668 ms</font>
</pre>

Teen skriptin, joka ottaa parametrina kaupungin ja tulostaa tämän hetkisen päivän ja kellonajan sekä syötetyn kaupungin sään. Skripti on tässä:
<pre><font color="#00AAAA">#!/bin/bash</font>
<font color="#5555FF"><b>echo</b></font> Aika on nyt <font color="#00AA00">`</font>date +%x<font color="#00AA00">`</font> <font color="#00AA00">`</font>date +%X<font color="#00AA00">`</font>
<font color="#5555FF"><b>echo</b></font>
<font color="#5555FF"><b>echo</b></font> <font color="#FFFF55"><b>&apos;Sää on nyt&apos;</b></font>
weather <font color="#FF5555"><b>$1</b></font>
</pre>

Siirrän skriptin kaikkien käyttöön saltilla /usr/local/bin hakemistoon oikeudet säädettynä oikein samaan tapaan kuin edellisessä tehtävässä. Ennen salt tilan ajoa kopioin vielä skriptin saltin hakemistoon, jotta homma toimii `sudo cp whatsup.sh /srv/salt/whatsup/` käskyllä

Koko salt-tila:
![Image](h5_images/h5_2.PNG)

<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ sudo salt &apos;*&apos; state.apply whatsup
<font color="#00AA00">sannanorja:</font>
<font color="#00AA00">----------</font>
    <font color="#00AA00">      ID: weather-util</font>
    <font color="#00AA00">Function: pkg.installed</font>
    <font color="#00AA00">  Result: True</font>
    <font color="#00AA00"> Comment: All specified packages are already installed</font>
    <font color="#00AA00"> Started: 22:20:06.857890</font>
    <font color="#00AA00">Duration: 56.291 ms</font>
<font color="#00AA00">     Changes:   </font>
<font color="#00AAAA">----------</font>
    <font color="#00AAAA">      ID: /usr/local/bin/whatsup.sh</font>
    <font color="#00AAAA">Function: file.managed</font>
    <font color="#00AAAA">  Result: True</font>
    <font color="#00AAAA"> Comment: File /usr/local/bin/whatsup.sh updated</font>
    <font color="#00AAAA"> Started: 22:20:06.916474</font>
    <font color="#00AAAA">Duration: 23.918 ms</font>
<font color="#00AAAA">     Changes:   </font>
<font color="#00AAAA">              ----------</font>
              <font color="#00AAAA">diff</font>:
                  <font color="#00AA00">New file</font>
              <font color="#00AAAA">mode</font>:
                  <font color="#00AA00">0755</font>

<font color="#00AAAA">Summary for sannanorja</font>
<font color="#00AAAA">------------</font>
<font color="#00AA00">Succeeded: 2</font> (<font color="#00AA00">changed=1</font>)
<font color="#00AAAA">Failed:    0</font>
<font color="#00AAAA">------------</font>
<font color="#00AAAA">Total states run:     2</font>
<font color="#00AAAA">Total run time:  80.209 ms</font>
</pre>

Deletoin skriptin omasta hakemistostani ja testaan skriptiä ja tarkastetaan oikeudet:
<pre><font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ whatsup.sh tampere
Aika on nyt 29.04.2022 22.22.43

Sää on nyt
Searching via name...
[using result Tampere / Pirkkala, Finland]
Current conditions at Tampere / Pirkkala, Finland (EFTP) 61-25N 023-35E 112M
Last updated Apr 29, 2022 - 03:20 PM EDT / 2022.04.29 1920 UTC
   Temperature: 33 F (1 C)
   Relative Humidity: 55%
   Wind: from the W (280 degrees) at 5 MPH (4 KT)
   Windchill: 28 F (-2 C)
<font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~</b></font>$ ls -l /usr/local/bin/ | grep whatsup
-rwxr-xr-x 1 root root 87 29. 4. 22:20 whatsup.sh
</pre>


## Tehtävä c, hello.py

Tee järjestelmään uusi komento Pythonilla ja asenna se orjille. Vinkkejä: Hei maailma riittää, mutta propellihatut saavat toki koodaillakin. Shebang on "#!/usr/bin/python3". Helpoin Python-komento on: print("Hei Tero!")

## Tehtävä d, laiskaa skriptailua

Tee kansio, josta jokainen skripti kopioituu orjille. Vinkki: 'salt-call --local sys.state_doc file.recurse'. Kun tämä on valmis, on todella helppoa laittaa orjille mikä tahansa yhden tiedoston shell script, Python-ohjelma, Perl-ohjelma, Go-binääri tai muu yhden binäärin ohjelma.

## Tehtävä e, Intel

Etsi kolme loppuprojektia joltain vanhalta kurssitoteutukselta. Kuvaile projektit tiiviisti ja linkitä alkuperäiseeen raporttin. Vinkkejä: Loppuprojekteja löydät etsimällä opiskelijoiden raportteja vanhoilta kursseilta ja selailemalla sivuja, joilta ne löytyivät. Raportteja löytyy vanhojen kurssitotetusten kommenteista. Ja tietysti kannattaa silmäillä listaa sieltä täältä, niin näet eri projektit kuin muut. Voi hakea myös Googlella ja DuckDuckGolla.

## Tehtävä e (toinen e),  Lukua, ei luottamusta. 

Kokeile yhtä kohdassa d-Intel löytämääsi modulia koneella. Tämä on infraa koodina, joten luottamusta ei tarvita. Voit lukea koodista, mitä olet ajamassa.