<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <title>Linux palvelimet</title>
    </head>
    <body>
        <nav class="nav nav-tabs">
            <a class="nav-link" href="index.html">Etusivu</a>
            <a class="nav-link" href="h1.html">H1</a>
            <a class="nav-link" href="h2.html">H2</a>
            <a class="nav-link" href="h3.html">H3</a>
            <a class="nav-link" href="h4.html">H4</a>
            <a class="nav-link" active>H5</a>
            <a class="nav-link" href="h6.html">H6</a>
        </nav>

        <div class="jumbotron" style="padding-top: 20px;">           
            <h1>Harjoitus H5</h1>

            <div class="container" style="padding-top: 20px;">
                <div class="row">
                    <div class="col-3">Nimi</div>
                    <div class="col">Sanna Jyrinki</div>
                </div>
                <div class="row">
                    <div class="col-3">Oppilaitos</div>
                    <div class="col">Haaga-Helian ammattikorkeakoulu</div>
                </div>
                <div class="row">
                    <div class="col-3">Kurssi</div>
                    <div class="col">
                        <a href="https://terokarvinen.com/2021/linux-palvelimet-ict4tn021-3018/">linux-palvelimet-ict4tn021-3018</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">Opettaja</div>
                    <div class="col">Tero Karvinen</div>
                </div>
            </div>
            <div class="container" style="padding-top: 20px;">
                <div class="row">
                    <div class="col-3">Tietokoneena</div>
                    <div class="col">Intel(R) Core(TM) i7-6500U CPU @ 2.50GHz</div>
                </div>
                <div class="row">
                    <div class="col-3">Käyttöjärjestelmä</div>
                    <div class="col">Windows 10 Home, Versio 20H2</div>
                </div>
                <div class="row">
                    <div class="col-3">Linux</div>
                    <div class="col">Virtual Box 6.1, Debian 11.2</div>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Lähteet</h5>
                    <p>Karvinen, T. 2022. Django 4 Instant Customer Database Tutorial. 
                        Luettavissa 
                    <a href="https://terokarvinen.com/2022/django-instant-crm-tutorial/">
                        https://terokarvinen.com/2022/django-instant-crm-tutorial/    
                    </a>. Luettu 24.2.2022.
                    </p>
                    <p>Karvinen, T. 2022. Deploy Django 4 - Production Install. 
                        Luettavissa 
                    <a href="https://terokarvinen.com/2022/deploy-django/">
                        https://terokarvinen.com/2022/deploy-django/    
                    </a>. Luettu 24.2.2022.
                    </p>

                    <h5 class="card-title">Tehtävä a, CRUD sovellus Django kehityspalvelimelle</h5>
                  
                    <p><h6 class="card-subtitle mb-2 text-muted">Asennetaan Django kehitysympäristö</h6></p>
                    
                    <p>Asennetaan virtualenv, jonka mukana tulee uusimmat python paketit, kuten Django</p>
                    <pre>
                        $ sudo apt-get -y install virtualenv
                    </pre>

                    <p>Luodaan /env hakemisto, jolla on käytössä uusimmat paketit ja python3</p>
                    <pre>
                        $ virtualenv --system-site-packages -p python3 env/
                    </pre>

                    <p>Käytetään uutta virtual environmentia</p>
                    <pre>
                        $ source env/bin/activate
                    </pre>

                    <p>Tarkastetaan, että asennus menee virtuaaliseen ympäristöön</p>
                    <pre>
                        $ which pip
                        /home/sanna/env/bin/pip
                    </pre>

                    <p>Asennetaan micro tekstieditori-ohjelma</p>
                    <pre>
                        $ sudo apt-get install micro
                    </pre>
                    
                    <p>Luodaan requirements.txt tiedosto ja kirjoitetaan sinne ajettava käsky 'django'
                    </p>
                    <pre>
                        $ micro requirements.txt # kirjoitettu sisällöksi django
                    </pre>
                    
                    <p>Tarkastetaan sisältö</p>
                    <pre>
                        $ cat requirements.txt 
                        django
                    </pre>
                    
                    <p>Asennetaan django</p>
                    <pre>
                        $ pip install -r requirements.txt
                        Collecting django
                          Downloading Django-4.0.2-py3-none-any.whl (8.0 MB)
                             |████████████████████████████████| 8.0 MB 1.0 MB/s 
                        Collecting asgiref&lt;4,&gt;=3.4.1
                          Downloading asgiref-3.5.0-py3-none-any.whl (22 kB)
                        Collecting sqlparse&gt;=0.2.2
                          Downloading sqlparse-0.4.2-py3-none-any.whl (42 kB)
                             |████████████████████████████████| 42 kB 157 kB/s 
                        Installing collected packages: sqlparse, asgiref, django
                        Successfully installed asgiref-3.5.0 django-4.0.2 sqlparse-0.4.2
                    </pre>
                    
                    <p>Tarkastetaan asennuksen versio</p>
                    <pre>
                        $ django-admin --version
                        4.0.2
                    </pre>

                    <p><h6 class="card-subtitle mb-2 text-muted">Luodaan oma Django-projekti</h6></p>
                    
                    <p>Djangossa koko webbisivu on django-projekti, luodaan oma django-projekti nimeltään sannandjango</p>
                    <pre>
                        $ django-admin startproject sannandjango
                    </pre>

                    <p>Yritetään käynnistää projekti</p>
                    <pre>
                        $ cd sannandjango/
                        $ ./manage.py runserver
                        Watching for file changes with StatReloader
                        Performing system checks...
                        
                        System check identified no issues (0 silenced).
                        
                        <font color="#AA0000">You have 18 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.</font>
                        <font color="#AA0000">Run &apos;python manage.py migrate&apos; to apply them.</font>
                        February 23, 2022 - 19:43:17
                        Django version 4.0.2, using settings &apos;sannandjango.settings&apos;
                        Starting development server at http://127.0.0.1:8000/
                        Quit the server with CONTROL-C.
                    </pre>
                
                    <p>Käynnistys valittaa migraatioiden puutteesta, muttei vielä välitetä tästä, vaan testataan selaimella http://127.0.0.1:8000/ osoitetta, asennus toimii!!</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/a_1.PNG" alt="Responsive image">

                    <p><h6 class="card-subtitle mb-2 text-muted">Tehdään käyttäjät admin-käyttöliittymälle</h6></p>

                    <p>Admin käyttöliittymälle pääsee, muttei vielä ole tunnusta, joka toimisi</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/a_2.PNG" alt="Responsive image">

                    <p>Päivitetään djangon tietokannat</p>
                    <pre>
                        $ ./manage.py makemigrations
                        No changes detected
                        $ ./manage.py migrate
                        <font color="#55FFFF"><b>Operations to perform:</b></font>
                        <b>  Apply all migrations: </b>admin, auth, contenttypes, sessions
                        <font color="#55FFFF"><b>Running migrations:</b></font>
                            Applying contenttypes.0001_initial...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0001_initial...<font color="#55FF55"><b> OK</b></font>
                            Applying admin.0001_initial...<font color="#55FF55"><b> OK</b></font>
                            Applying admin.0002_logentry_remove_auto_add...<font color="#55FF55"><b> OK</b></font>
                            Applying admin.0003_logentry_add_action_flag_choices...<font color="#55FF55"><b> OK</b></font>
                            Applying contenttypes.0002_remove_content_type_name...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0002_alter_permission_name_max_length...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0003_alter_user_email_max_length...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0004_alter_user_username_opts...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0005_alter_user_last_login_null...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0006_require_contenttypes_0002...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0007_alter_validators_add_error_messages...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0008_alter_user_username_max_length...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0009_alter_user_last_name_max_length...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0010_alter_group_name_max_length...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0011_update_proxy_permissions...<font color="#55FF55"><b> OK</b></font>
                            Applying auth.0012_alter_user_first_name_max_length...<font color="#55FF55"><b> OK</b></font>
                            Applying sessions.0001_initial...<font color="#55FF55"><b> OK</b></font>
                    </pre>

                    <p>Asennetaan pwgen ja luodaan sillä salasana</p>
                    <pre>
                        $ sudo apt-get install pwgen
                        [sudo] password for sanna: 
                        Reading package lists... Done
                        Building dependency tree... Done
                        Reading state information... Done
                        The following NEW packages will be installed:
                          pwgen
                        0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
                        Need to get 19,6 kB of archives.
                        After this operation, 52,2 kB of additional disk space will be used.
                        Get:1 http://deb.debian.org/debian bullseye/main amd64 pwgen amd64 2.08-2 [19,6 kB]
                        Fetched 19,6 kB in 0s (59,6 kB/s)
                        Selecting previously unselected package pwgen.
                        (Reading database ... 230419 files and directories currently installed.)
                        Preparing to unpack .../pwgen_2.08-2_amd64.deb ...
                        Unpacking pwgen (2.08-2) ...
                        Setting up pwgen (2.08-2) ...
                        Processing triggers for man-db (2.9.4-2) ...
                        $ pwgen -s 20 1
                    </pre>
                                
                    <p>Luodaan admin käyttäjä käyttäen luotua salasanaa</p>
                    <pre>
                        $ ./manage.py createsuperuser
                         Username (leave blank to use &apos;sanna&apos;): 
                        Email address: 
                        Password: 
                        Password (again): 
                        Superuser created successfully.
                    </pre>

                    <p>Käynnistetään kehityspalvelin uudelleen</p>
                    <pre>
                        $ ./manage.py runserver
                    </pre>

                    <p>Nyt päästään luodulla tunnuksella ja salasanalla kirjautumaan admin-käyttöliittymään</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/a_3.PNG" alt="Responsive image">

                    <p>Luodaan admin-käyttöliittymältä uusi käyttäjä minna</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/a_4.PNG" alt="Responsive image">
                    
                    <p>Valitaan staff ja superuser status, jotta se saa samat admin-oikeudet</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/a_5.PNG" alt="Responsive image">

                    <p>Kirjaudutaan ulos sanna tunnuksesta ja kirjaudutaan uudelleen luodulla minna tunnuksella ja tarkistetaan, että kirjautuminen onnistuu, ja että minnalla on myös oikeus lisätä uusia käyttäjiä</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/a_6.PNG" alt="Responsive image">

                    <p><h6 class="card-subtitle mb-2 text-muted">Luodaan Books sovellus</h6></p>
                    <p>Tehdään Djangolla Books sovellus, joka on yrityksen sähköinen kirjahylly, josta työntekijät voivat ylläpitää yrityksen toimistolla olevaa kirjahyllyä, 
                        ja merkitä onko kirja saatavilla vaiko lainattu.
                    </p>

                    <p>Luodaan sovellus, tämä tekee sovellukselle bookcase-nimisen hakemiston</p>
                    <pre>
                        $ ./manage.py startapp bookcase
                    </pre>

                    <p>Lisätään sovellus sannandjango/settings.py asennettujen sovellusten listaan</p>
                    <pre>
                        $ micro sannandjango/settings.py
                        ...
                        INSTALLED_APPS = [
                            &apos;django.contrib.admin&apos;,
                            &apos;django.contrib.auth&apos;,
                            &apos;django.contrib.contenttypes&apos;,
                            &apos;django.contrib.sessions&apos;,
                            &apos;django.contrib.messages&apos;,
                            &apos;django.contrib.staticfiles&apos;,
                            &apos;bookcase&apos; #lisäsin tämän rivin,
                        ]
                        ...
                    </pre>

                    <p>Lisätään modeliin Book</p>
                    <pre>
                        $ micro bookcase/models.py
                        from django.db import models

                        class Book(models.Model):
                            author = models.CharField(max_length=300)
                            title = models.CharField(max_length=300)
                            available = models.BooleanField(default=True)
                    </pre>

                    <p>Ajetaan migraatiot, jolloin modeliin mukaan syntyy taulut tietokantaan</p>
                    <pre>
                        (env) <font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~/sannandjango</b></font>$ ./manage.py makemigrations
                        <font color="#55FFFF"><b>Migrations for &apos;bookcase&apos;:</b></font>
                          <b>bookcase/migrations/0001_initial.py</b>
                            - Create model Book
                        (env) <font color="#55FF55"><b>sanna@sanna-virtualbox</b></font>:<font color="#5555FF"><b>~/sannandjango</b></font>$ ./manage.py migrate
                        <font color="#55FFFF"><b>Operations to perform:</b></font>
                        <b>  Apply all migrations: </b>admin, auth, bookcase, contenttypes, sessions
                        <font color="#55FFFF"><b>Running migrations:</b></font>
                          Applying bookcase.0001_initial...<font color="#55FF55"><b> OK</b></font>
                    </pre>

                    <p>Jotta tietokanta näkyy /admin osoitteessa, se täytyy rekisteröidä</p>
                    <pre>
                        $ micro bookcase/admin.py
                        from django.contrib import admin
                        from . import models

                        admin.site.register(models.Book)
                    </pre>

                    <p>Käynnistetään serveri ja testataan</p>
                    <pre>
                        $ ./manage.py runserver
                    </pre>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/a_7.PNG" alt="Responsive image">

                    <p>Lisätään admin käyttöliittymällä muutama kirja</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/a_8.PNG" alt="Responsive image">

                    <p>Muokataan models.py tiedostoa siten, että admin-käyttöliittymässä näkyy kirjojen nimet</p>
                    <pre>
                        $ micro bookcase/models.py
                        from django.db import models

                        class Book(models.Model):
                            author = models.CharField(max_length=300)
                            title = models.CharField(max_length=300)
                            available = models.BooleanField(default=True)
                            
                            def __str__(self):		# new
                                if self.available:
                                    return self.author + &apos; : &apos; + self.title
                                else:
                                    return self.author + &apos; : &apos; + self.title + &apos; (NOT AVAILABLE)&apos;	
                    </pre>
                    <p>Nyt kirjojen tiedot näkyy listassa</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/a_9.PNG" alt="Responsive image">

                    <h5 class="card-title">Tehtävä b, Django tuotantoasennus</h5>

                    <p>Päätin tehdä Django tuotantoasennuksen virtuaalipalvelimellani, jonka asensin tehtävässä 4.
                        Virtuaalipalvelimella on jo tehtävässä 4 asennettuna micro tekstieditori, sekä apache2.
                        Tässä tehtävässä vielä korvaan apachen testisivun seuraavalla merkkijonolla.
                    </p>
                    <pre>
                        $ echo "Welcome to jyrinki.com"|sudo tee /var/www/html/index.html
                    </pre>

                    <p>Apachen testisivu näkyy nyt osoitteessa http://jyrinki.com</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/b_1.PNG" alt="Responsive image">

                    <p><h6 class="card-subtitle mb-2 text-muted">Staattinen sivu</h6></p>

                    <p>Teen alkuun apt-get updaten</p>
                    <pre>
                        $ sudo apt-get update
                    </pre>

                    <p>Tehdään aluksi staattinen sivu kotihakemistoni alle</p>
                    <pre>
                        $ cd
                        $ mkdir -p publicwsgi/sannandjango/static/
                        $ echo "Statically see you at jyrinki.com."|tee publicwsgi/sannandjango/static/index.html
                    </pre>

                    <p>Tehdään uusi VirtualHost</p>
                    <pre>
                        $ sudoedit /etc/apache2/sites-available/sannandjango.conf
                        &lt;VirtualHost *:80&gt;
                            Alias /static/ /home/sanna/publicwsgi/sannandjango/static/
                            &lt;Directory /home/sanna/publicwsgi/sannandjango/static/&gt;
                                Require all granted
                            &lt;/Directory&gt;
                        &lt;/VirtualHost&gt;
                    </pre>

                    <p>Enabloidaan uusi web-sivu ja disabloidaan muut</p>
                    <pre>
                        $ sudo a2ensite sannandjango.conf
                        $ sudo a2dissite 000-default.conf 
                    </pre>
                    <p>Testataan, saatiin virheilmoituksia, mutta lopussa teksti syntax ok, ilmeisesti homma ok</p>
                    <pre>
                        sanna@debian-1cpu-1gb-fi-hel1:~$ /sbin/apache2ctl configtest
                        AH00557: apache2: apr_sockaddr_info_get() failed for debian-1cpu-1gb-fi-hel1
                        AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1. Set the 'ServerName' directive globally to suppress this message
                        Syntax OK
                    </pre>
                    
                    <p>Käynnistetään apache uudelleen</p>
                    <pre>
                        $ sudo systemctl restart apache2
                    </pre>

                    <p>Testataan selaimella sivua http://jyrinki.com/static/, ja staattinen sivu näyttää toimivan</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/b_2.PNG" alt="Responsive image">

                    <p><h6 class="card-subtitle mb-2 text-muted">Luodaan virtual env</h6></p>
                    <pre>
                        $ sudo apt-get -y install virtualenv

                        $ cd
                        $ cd publicwsgi/

                        $ virtualenv -p python3 --system-site-packages env
                    </pre>

                    <p><h6 class="card-subtitle mb-2 text-muted">Asennetaan Django</h6></p>

                    <p>Asennus tehdään kuten kehitysserverillä</p>
                    <pre>
                        $ source env/bin/activate
                        $ which pip
                        /home/sanna/publicwsgi/env/bin/pip
                        $ micro requirements.txt
                        django
                        $ pip install -r requirements.txt
                        Collecting django
                          Using cached Django-4.0.2-py3-none-any.whl (8.0 MB)
                        Collecting asgiref<4,>=3.4.1
                          Using cached asgiref-3.5.0-py3-none-any.whl (22 kB)
                        Collecting sqlparse>=0.2.2
                          Using cached sqlparse-0.4.2-py3-none-any.whl (42 kB)
                        Installing collected packages: sqlparse, asgiref, django
                        Successfully installed asgiref-3.5.0 django-4.0.2 sqlparse-0.4.2
                        $ django-admin --version
                        4.0.2
                    </pre>

                    <p><h6 class="card-subtitle mb-2 text-muted">Luodaan projekti</h6></p>

                    <p>Yritin luoda Django-projektin ohjeen mukaan. 
                        Se ei kuitenkaan onnistunut, koska sannandjango-hakemisto oli jo luotu staattista sivua varten.
                    </p>
                    <pre>
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi$ django-admin startproject sannandjango
                        CommandError: '/home/sanna/publicwsgi/sannandjango' already exists
                    </pre>

                    <p>Poistan sannandjango-hakemiston ja perustan projektin ja lisään sen jälkeen staattisen sivun uudelleen</p>
                    <pre>
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi$ rm -r sannandjango/
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi$ django-admin startproject sannandjango
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi$ ls
                        env  requirements.txt  sannandjango
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi$ mkdir -p publicwsgi/sannandjango/static/
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi$ echo "Statically see you at jyrinki.com."|tee publicwsgi/sannandjango/static/index.html
                        Statically see you at jyrinki.com.
                    </pre>

                    <p><h6 class="card-subtitle mb-2 text-muted">Yhdistetään Python Apacheen</h6></p>

                    <p>Tehdään sannandjango.conf tiedosto ohjeen mallin mukaan</p>
                    <pre>
                        $ sudoedit /etc/apache2/sites-available/sannandjango.conf
                    </pre>
                    <p>sisältö</p>
                    <pre>
                        Define TDIR /home/sanna/publicwsgi/sannandjango
                        Define TWSGI /home/sanna/publicwsgi/sannandjango/sannandjango/wsgi.py
                        Define TUSER sanna
                        Define TVENV /home/sanna/publicwsgi/env/lib/python3.9/site-packages

                        &lt;VirtualHost *:80&gt;
                            Alias /static/ ${TDIR}/static/
                            &lt;Directory ${TDIR}/static/&gt;
                                Require all granted
                            &lt;/Directory&gt;

                            WSGIDaemonProcess ${TUSER} user=${TUSER} group=${TUSER} threads=5 python-path="${TDIR}:${TVENV}"
                            WSGIScriptAlias / ${TWSGI}
                            &lt;Directory ${TDIR}&gt;
                                WSGIProcessGroup ${TUSER}
                                WSGIApplicationGroup %{GLOBAL}
                                WSGIScriptReloading On
                                &lt;Files wsgi.py&gt;
                                    Require all granted
                                &lt;/Files&gt;
                            &lt;/Directory&gt;

                        &lt;/VirtualHost&gt;

                        Undefine TDIR
                        Undefine TWSGI
                        Undefine TUSER
                        Undefine TVENV
                    </pre>

                    <p>Asennettetaan apachelle wsgi moduuli</p>
                    <pre>
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi/sannandjango$ sudo apt-get -y install libapache2-mod-wsgi-py3
                        sudo: unable to resolve host debian-1cpu-1gb-fi-hel1: Name or service not known
                        Reading package lists... Done
                        Building dependency tree... Done
                        Reading state information... Done
                        The following NEW packages will be installed:
                          libapache2-mod-wsgi-py3
                        0 upgraded, 1 newly installed, 0 to remove and 3 not upgraded.
                        Need to get 99.7 kB of archives.
                        After this operation, 293 kB of additional disk space will be used.
                        Get:1 http://deb.debian.org/debian bullseye/main amd64 libapache2-mod-wsgi-py3 amd64 4.7.1-3+b1 [99.7 kB]
                        Fetched 99.7 kB in 0s (8645 kB/s)
                        Selecting previously unselected package libapache2-mod-wsgi-py3.
                        (Reading database ... 38704 files and directories currently installed.)
                        Preparing to unpack .../libapache2-mod-wsgi-py3_4.7.1-3+b1_amd64.deb ...
                        Unpacking libapache2-mod-wsgi-py3 (4.7.1-3+b1) ...
                        Setting up libapache2-mod-wsgi-py3 (4.7.1-3+b1) ...
                        apache2_invoke: Enable module wsgi
                    </pre>

                    <p>Tarkistetaan syntaksi</p>
                    <pre>
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi/sannandjango$ /sbin/apache2ctl configtest
                        AH00557: apache2: apr_sockaddr_info_get() failed for debian-1cpu-1gb-fi-hel1
                        AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1. Set the 'ServerName' directive globally to suppress this message
                        Syntax OK
                    </pre>

                    <p>Otetaan käyttöön</p>
                    <pre>
                        $ sudo systemctl restart apache2
                    </pre>

                    <p>Testataan, curl joudutaan välissä asentamaan, koska käskyä ei löydy</p>
                    <pre>
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi/sannandjango$ curl -s localhost|grep title
                        -bash: curl: command not found

                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi/sannandjango$ sudo apt-get -y install curl
                        sudo: unable to resolve host debian-1cpu-1gb-fi-hel1: Name or service not known
                        Reading package lists... Done
                        Building dependency tree... Done
                        Reading state information... Done
                        The following NEW packages will be installed:
                          curl
                        0 upgraded, 1 newly installed, 0 to remove and 3 not upgraded.
                        Need to get 267 kB of archives.
                        After this operation, 436 kB of additional disk space will be used.
                        Get:1 http://deb.debian.org/debian bullseye/main amd64 curl amd64 7.74.0-1.3+deb11u1 [267 kB]
                        Fetched 267 kB in 0s (16.1 MB/s)
                        Selecting previously unselected package curl.
                        (Reading database ... 38714 files and directories currently installed.)
                        Preparing to unpack .../curl_7.74.0-1.3+deb11u1_amd64.deb ...
                        Unpacking curl (7.74.0-1.3+deb11u1) ...
                        Setting up curl (7.74.0-1.3+deb11u1) ...
                        
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi$ curl -s jyrinki.com|grep title
                        &lt;title&gt;DisallowedHost
                                at /&lt;/title&gt;
                          &lt;input type="hidden" name="title"
                    </pre>
                    <p>Sivu ei toimi kuten ohjeessa, jatketaan kuitenkin eteenpäin</p>

                    <p><h6 class="card-subtitle mb-2 text-muted">Disabloidaan DEBUG</h6></p>

                    <p>Editoidaan settings.py tiedostoon DEBUG moodi false ja sallitut sivut</p>
                    <pre>
                        $ cd
                        $ cd publicwsgi/sannandjango/
                        $ micro sannandjango/settings.py 
                        ...
                        DEBUG = False
                        ALLOWED_HOSTS = ["jyrinki.com"]

                        $ touch sannandjango/wsgi.py
                        $ sudo systemctl restart apache2

                        curl -s jyrinki.com|grep title
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi/sannandjango$ curl -s jyrinki.com|grep title
                        &lt;title&gt;Not Found&lt;/title&gt;
                    </pre>
                    <p>Nyt niinkuin pitääkin, ei jyrinki.com sivulla näy mitään sivua, koska sellaista ei ole tehty, eikä myöskään debug-sivua näy.
                    </p>

                    <p><h6 class="card-subtitle mb-2 text-muted">Nyt voidaan lähteä tekemään Django-sovellusta ja luoda käyttäjä kuten kehitysympäristössäkin</h6></p>

                    <p>Admin sivu toimii, mutta sen tyylit ei toimi</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/b_3.PNG" alt="Responsive image">

                    <p>Korjataan asia siirtämällä myös css-tyylisivut static hakemistoon.
                        Muokataan settings.py tiedostoa.
                    </p>
                    <pre>
                        $ cd
                        $ cd publicwsgi/sannandjango/
                        $ micro sannandjango/settings.py
                    </pre>

                    <p>Lisätään tiedostoon seuraavat rivit</p>
                    <pre>
                        import os
                        STATIC_ROOT = os.path.join(BASE_DIR, 'static/')
                    </pre>

                    <p>Ajetaan tiedostot static hakemistoon</p>
                    <pre>
                        (env) sanna@debian-1cpu-1gb-fi-hel1:~/publicwsgi/sannandjango$ ./manage.py collectstatic

                        You have requested to collect static files at the destination
                        location as specified in your settings:
                        
                            /home/sanna/publicwsgi/sannandjango/static
                        
                        This will overwrite existing files!
                        Are you sure you want to do this?
                        
                        Type 'yes' to continue, or 'no' to cancel: yes
                        
                        128 static files copied to '/home/sanna/publicwsgi/sannandjango/static'.
                    </pre>

                    <p>Nyt sisäännkirjautumissivulla näkyy tyylit</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/b_4.PNG" alt="Responsive image">

                    <p><h6 class="card-subtitle mb-2 text-muted">Luodaan sovellus</h6></p>

                    <p>Luodaan admin käyttäjä kuten kehitysserverilläkin</p>
                    <pre>
                        $ ./manage.py makemigrations
                        $ ./manage.py migrate
                        $ sudo apt-get install pwgen
                        $ pwgen -s 20 1
                        $ ./manage.py createsuperuser
                    </pre>

                    <p>Nyt päästään admin-käyttöliittymälle</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/b_5.PNG" alt="Responsive image">

                    <p>Luodaan sovellus friend</p>
                    <pre>
                        $ ./manage.py startapp friend
                        $ micro sannandjango/settings.py # lisätään asennettujen sovellusten listaan
                    </pre>

                    <p>Muokataan model</p>
                    <pre>
                        $ micro friend/models.py
                        from django.db import models

                        class Friend(models.Model):
                            name = models.CharField(max_length = 300)
                        
                            def __str__(self):
                                return self.name
                    </pre>

                    <p>Ajetaan migraatiot</p>
                    <pre>
                        $ ./manage.py makemigrations
                        $ ./manage.py migrate  
                    </pre>

                    <p>Rekisteröidään tietokanta
                    </p>
                    <pre>
                        $ micro friend/admin.py
                        from django.contrib import admin
                        from . import models

                        admin.site.register(models.Friend)
                    </pre>

                    <p>Admin käyttöliittymältä nähdään nyt ystävät</p>
                    <img style="border: solid 1px" class="card-img-bottom img-fluid" src="h5_images/b_6.PNG" alt="Responsive image">


                </div>
            </div>
		</div>
    </div>
</html>
